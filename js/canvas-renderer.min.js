THREE.SpriteCanvasMaterial=function(a){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(c,b){};this.setValues(a)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;THREE.SpriteCanvasMaterial.prototype.clone=function(){var a=new THREE.SpriteCanvasMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.program=this.program;return a};THREE.CanvasRenderer=function(H){var aE=THREE.Math.smoothstep;H=H||{};var y=this,E,J,n,a=new THREE.Projector(),j=H.canvas!==undefined?H.canvas:document.createElement("canvas"),B=j.width,aD=j.height,al=Math.floor(B/2),M=Math.floor(aD/2),c=0,b=0,aG=B,A=aD,p=1,g=j.getContext("2d",{alpha:H.alpha===true}),K=new THREE.Color(0),az=H.alpha===true?0:1,aF=1,aB=0,z=null,aA=null,O=null,l=null,aw=null,T=[],aN,ak,aj,ah,ag,af=new THREE.RenderableVertex(),ad=new THREE.RenderableVertex(),x,w,f,d,aM,aK,ay,ax,Y,W,S,Q,h=new THREE.Color(),t=new THREE.Color(),s=new THREE.Color(),r=new THREE.Color(),q=new THREE.Color(),ab=new THREE.Color(),u=new THREE.Color(),at=new THREE.Color(),L={},ac,k,aL,aI,av,ar,X,V,aP=new THREE.Box2(),v=new THREE.Box2(),D=new THREE.Box2(),aH=new THREE.Color(),G=new THREE.Color(),ai=new THREE.Color(),m=new THREE.Vector3(),aQ=new THREE.Vector3(),aa=new THREE.Vector3(),R=new THREE.Matrix3();if(g.setLineDash===undefined){g.setLineDash=function(){}}this.domElement=j;this.autoClear=true;this.sortObjects=true;this.sortElements=true;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getPixelRatio=function(){return p};this.setPixelRatio=function(aS){p=aS};this.setSize=function(aT,aS,aU){B=aT*p;aD=aS*p;j.width=B;j.height=aD;al=Math.floor(B/2);M=Math.floor(aD/2);if(aU!==false){j.style.width=aT+"px";j.style.height=aS+"px"}aP.min.set(-al,-M),aP.max.set(al,M);v.min.set(-al,-M);v.max.set(al,M);aF=1;aB=0;z=null;aA=null;O=null;l=null;aw=null;this.setViewport(0,0,aT,aS)};this.setViewport=function(aT,aV,aU,aS){c=aT*p;b=aV*p;aG=aU*p;A=aS*p};this.setScissor=function(){};this.enableScissorTest=function(){};this.setClearColor=function(aS,aT){K.set(aS);az=aT!==undefined?aT:1;v.min.set(-al,-M);v.max.set(al,M)};this.setClearColorHex=function(aS,aT){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(aS,aT)};this.getClearColor=function(){return K};this.getClearAlpha=function(){return az};this.getMaxAnisotropy=function(){return 0};this.clear=function(){if(v.empty()===false){v.intersect(aP);v.expandByScalar(2);v.min.x=v.min.x+al;v.min.y=-v.min.y+M;v.max.x=v.max.x+al;v.max.y=-v.max.y+M;if(az<1){g.clearRect(v.min.x|0,v.max.y|0,(v.max.x-v.min.x)|0,(v.min.y-v.max.y)|0)}if(az>0){ao(THREE.NormalBlending);F(1);am("rgba("+Math.floor(K.r*255)+","+Math.floor(K.g*255)+","+Math.floor(K.b*255)+","+az+")");g.fillRect(v.min.x|0,v.max.y|0,(v.max.x-v.min.x)|0,(v.min.y-v.max.y)|0)}v.makeEmpty()}};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(aX,aV){if(aV instanceof THREE.Camera===false){console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");return}if(this.autoClear===true){this.clear()}y.info.render.vertices=0;y.info.render.faces=0;g.setTransform(aG/B,0,0,-A/aD,c,aD-b);g.translate(al,M);E=a.projectScene(aX,aV,this.sortObjects,this.sortElements);J=E.elements;n=E.lights;aN=aV;R.getNormalMatrix(aV.matrixWorldInverse);aq();for(var aW=0,aU=J.length;aW<aU;aW++){var aS=J[aW];var aT=aS.material;if(aT===undefined||aT.opacity===0){continue}D.makeEmpty();if(aS instanceof THREE.RenderableSprite){ak=aS;ak.x*=al;ak.y*=M;o(ak,aS,aT)}else{if(aS instanceof THREE.RenderableLine){ak=aS.v1;aj=aS.v2;ak.positionScreen.x*=al;ak.positionScreen.y*=M;aj.positionScreen.x*=al;aj.positionScreen.y*=M;D.setFromPoints([ak.positionScreen,aj.positionScreen]);if(aP.isIntersectionBox(D)===true){au(ak,aj,aS,aT)}}else{if(aS instanceof THREE.RenderableFace){ak=aS.v1;aj=aS.v2;ah=aS.v3;if(ak.positionScreen.z<-1||ak.positionScreen.z>1){continue}if(aj.positionScreen.z<-1||aj.positionScreen.z>1){continue}if(ah.positionScreen.z<-1||ah.positionScreen.z>1){continue}ak.positionScreen.x*=al;ak.positionScreen.y*=M;aj.positionScreen.x*=al;aj.positionScreen.y*=M;ah.positionScreen.x*=al;ah.positionScreen.y*=M;if(aT.overdraw>0){an(ak.positionScreen,aj.positionScreen,aT.overdraw);an(aj.positionScreen,ah.positionScreen,aT.overdraw);an(ah.positionScreen,ak.positionScreen,aT.overdraw)}D.setFromPoints([ak.positionScreen,aj.positionScreen,ah.positionScreen]);if(aP.isIntersectionBox(D)===true){aR(ak,aj,ah,0,1,2,aS,aT)}}}}v.union(D)}g.setTransform(1,0,0,1,0,0)};function aq(){aH.setRGB(0,0,0);G.setRGB(0,0,0);ai.setRGB(0,0,0);for(var aU=0,aV=n.length;aU<aV;aU++){var aT=n[aU];var aS=aT.color;if(aT instanceof THREE.AmbientLight){aH.add(aS)}else{if(aT instanceof THREE.DirectionalLight){G.add(aS)}else{if(aT instanceof THREE.PointLight){ai.add(aS)}}}}}function e(aS,aZ,aW){for(var aV=0,aY=n.length;aV<aY;aV++){var aU=n[aV];at.copy(aU.color);if(aU instanceof THREE.DirectionalLight){var aT=m.setFromMatrixPosition(aU.matrixWorld).normalize();var aX=aZ.dot(aT);if(aX<=0){continue}aX*=aU.intensity;aW.add(at.multiplyScalar(aX))}else{if(aU instanceof THREE.PointLight){var aT=m.setFromMatrixPosition(aU.matrixWorld);var aX=aZ.dot(m.subVectors(aT,aS).normalize());if(aX<=0){continue}aX*=aU.distance==0?1:1-Math.min(aS.distanceTo(aT)/aU.distance,1);if(aX==0){continue}aX*=aU.intensity;aW.add(at.multiplyScalar(aX))}}}}function o(a4,aW,aX){F(aX.opacity);ao(aX.blending);var a6=aW.scale.x*al;var a5=aW.scale.y*M;var a0=0.5*Math.sqrt(a6*a6+a5*a5);D.min.set(a4.x-a0,a4.y-a0);D.max.set(a4.x+a0,a4.y+a0);if(aX instanceof THREE.SpriteMaterial){var aZ=aX.map;if(aZ!==null&&aZ.image!==undefined){if(aZ.hasEventListener("update",C)===false){if(aZ.image.width>0){P(aZ)}aZ.addEventListener("update",C)}var aY=L[aZ.id];if(aY!==undefined){am(aY)}else{am("rgba( 0, 0, 0, 1 )")}var a3=aZ.image;var aT=a3.width*aZ.offset.x;var aS=a3.height*aZ.offset.y;var a2=a3.width*aZ.repeat.x;var a1=a3.height*aZ.repeat.y;var aV=a6/a2;var aU=a5/a1;g.save();g.translate(a4.x,a4.y);if(aX.rotation!==0){g.rotate(aX.rotation)}g.translate(-a6/2,-a5/2);g.scale(aV,aU);g.translate(-aT,-aS);g.fillRect(aT,aS,a2,a1);g.restore()}else{am(aX.color.getStyle());g.save();g.translate(a4.x,a4.y);if(aX.rotation!==0){g.rotate(aX.rotation)}g.scale(a6,-a5);g.fillRect(-0.5,-0.5,1,1);g.restore()}}else{if(aX instanceof THREE.SpriteCanvasMaterial){aC(aX.color.getStyle());am(aX.color.getStyle());g.save();g.translate(a4.x,a4.y);if(aX.rotation!==0){g.rotate(aX.rotation)}g.scale(a6,a5);aX.program(g);g.restore()}}}function au(aZ,aX,aV,aW){F(aW.opacity);ao(aW.blending);g.beginPath();g.moveTo(aZ.positionScreen.x,aZ.positionScreen.y);g.lineTo(aX.positionScreen.x,aX.positionScreen.y);if(aW instanceof THREE.LineBasicMaterial){N(aW.linewidth);ae(aW.linecap);aJ(aW.linejoin);if(aW.vertexColors!==THREE.VertexColors){aC(aW.color.getStyle())}else{var aU=aV.vertexColors[0].getStyle();var aS=aV.vertexColors[1].getStyle();if(aU===aS){aC(aU)}else{try{var aY=g.createLinearGradient(aZ.positionScreen.x,aZ.positionScreen.y,aX.positionScreen.x,aX.positionScreen.y);aY.addColorStop(0,aU);aY.addColorStop(1,aS)}catch(aT){aY=aU}aC(aY)}}g.stroke();D.expandByScalar(aW.linewidth*2)}else{if(aW instanceof THREE.LineDashedMaterial){N(aW.linewidth);ae(aW.linecap);aJ(aW.linejoin);aC(aW.color.getStyle());Z([aW.dashSize,aW.gapSize]);g.stroke();D.expandByScalar(aW.linewidth*2);Z([])}}}function aR(a0,aZ,aY,aV,aU,aT,aW,aX){y.info.render.vertices+=3;y.info.render.faces++;F(aX.opacity);ao(aX.blending);x=a0.positionScreen.x;w=a0.positionScreen.y;f=aZ.positionScreen.x;d=aZ.positionScreen.y;aM=aY.positionScreen.x;aK=aY.positionScreen.y;U(x,w,f,d,aM,aK);if((aX instanceof THREE.MeshLambertMaterial||aX instanceof THREE.MeshPhongMaterial)&&aX.map===null){ab.copy(aX.color);u.copy(aX.emissive);if(aX.vertexColors===THREE.FaceColors){ab.multiply(aW.color)}h.copy(aH);aQ.copy(a0.positionWorld).add(aZ.positionWorld).add(aY.positionWorld).divideScalar(3);e(aQ,aW.normalModel,h);h.multiply(ab).add(u);aX.wireframe===true?aO(h,aX.wireframeLinewidth,aX.wireframeLinecap,aX.wireframeLinejoin):i(h)}else{if(aX instanceof THREE.MeshBasicMaterial||aX instanceof THREE.MeshLambertMaterial||aX instanceof THREE.MeshPhongMaterial){if(aX.map!==null){var aS=aX.map.mapping;if(aS===THREE.UVMapping){k=aW.uvs;ap(x,w,f,d,aM,aK,k[aV].x,k[aV].y,k[aU].x,k[aU].y,k[aT].x,k[aT].y,aX.map)}}else{if(aX.envMap!==null){if(aX.envMap.mapping===THREE.SphericalReflectionMapping){aa.copy(aW.vertexNormalsModel[aV]).applyMatrix3(R);aL=0.5*aa.x+0.5;aI=0.5*aa.y+0.5;aa.copy(aW.vertexNormalsModel[aU]).applyMatrix3(R);av=0.5*aa.x+0.5;ar=0.5*aa.y+0.5;aa.copy(aW.vertexNormalsModel[aT]).applyMatrix3(R);X=0.5*aa.x+0.5;V=0.5*aa.y+0.5;ap(x,w,f,d,aM,aK,aL,aI,av,ar,X,V,aX.envMap)}}else{h.copy(aX.color);if(aX.vertexColors===THREE.FaceColors){h.multiply(aW.color)}aX.wireframe===true?aO(h,aX.wireframeLinewidth,aX.wireframeLinecap,aX.wireframeLinejoin):i(h)}}}else{if(aX instanceof THREE.MeshDepthMaterial){h.r=h.g=h.b=1-aE(a0.positionScreen.z*a0.positionScreen.w,aN.near,aN.far);aX.wireframe===true?aO(h,aX.wireframeLinewidth,aX.wireframeLinecap,aX.wireframeLinejoin):i(h)}else{if(aX instanceof THREE.MeshNormalMaterial){aa.copy(aW.normalModel).applyMatrix3(R);h.setRGB(aa.x,aa.y,aa.z).multiplyScalar(0.5).addScalar(0.5);aX.wireframe===true?aO(h,aX.wireframeLinewidth,aX.wireframeLinecap,aX.wireframeLinejoin):i(h)}else{h.setRGB(1,1,1);aX.wireframe===true?aO(h,aX.wireframeLinewidth,aX.wireframeLinecap,aX.wireframeLinejoin):i(h)}}}}}function U(aV,aX,aT,aW,aS,aU){g.beginPath();g.moveTo(aV,aX);g.lineTo(aT,aW);g.lineTo(aS,aU);g.closePath()}function aO(aS,aV,aU,aT){N(aV);ae(aU);aJ(aT);aC(aS.getStyle());g.stroke();D.expandByScalar(aV*2)}function i(aS){am(aS.getStyle());g.fill()}function C(aS){P(aS.target)}function P(aW){if(aW instanceof THREE.CompressedTexture){return}var aV=aW.wrapS===THREE.RepeatWrapping;var aU=aW.wrapT===THREE.RepeatWrapping;var aX=aW.image;var aS=document.createElement("canvas");aS.width=aX.width;aS.height=aX.height;var aT=aS.getContext("2d");aT.setTransform(1,0,0,-1,0,aX.height);aT.drawImage(aX,0,0);L[aW.id]=g.createPattern(aS,aV===true&&aU===true?"repeat":aV===true&&aU===false?"repeat-x":aV===false&&aU===true?"repeat-y":"no-repeat")}function ap(ba,aX,a7,aW,a4,aU,a6,aV,a3,aT,a2,aS,aZ){if(aZ instanceof THREE.DataTexture){return}if(aZ.hasEventListener("update",C)===false){if(aZ.image!==undefined&&aZ.image.width>0){P(aZ)}aZ.addEventListener("update",C)}var a5=L[aZ.id];if(a5!==undefined){am(a5)}else{am("rgba(0,0,0,1)");g.fill();return}var bh,bg,bf,be,bc,a9,aY,bd,bb=aZ.offset.x/aZ.repeat.x,a8=aZ.offset.y/aZ.repeat.y,a1=aZ.image.width*aZ.repeat.x,a0=aZ.image.height*aZ.repeat.y;a6=(a6+bb)*a1;aV=(aV+a8)*a0;a3=(a3+bb)*a1;aT=(aT+a8)*a0;a2=(a2+bb)*a1;aS=(aS+a8)*a0;a7-=ba;aW-=aX;a4-=ba;aU-=aX;a3-=a6;aT-=aV;a2-=a6;aS-=aV;aY=a3*aS-a2*aT;if(aY===0){return}bd=1/aY;bh=(aS*a7-aT*a4)*bd;bg=(aS*aW-aT*aU)*bd;bf=(a3*a4-a2*a7)*bd;be=(a3*aU-a2*aW)*bd;bc=ba-bh*a6-bf*aV;a9=aX-bg*a6-be*aV;g.save();g.transform(bh,bg,bf,be,bc,a9);g.fill();g.restore()}function I(a8,aX,a6,aW,a4,aU,a5,aV,a3,aT,a2,aS,a0){var be,bd,bc,bb,a9,a7,aY,ba,a1=a0.width-1,aZ=a0.height-1;a5*=a1;aV*=aZ;a3*=a1;aT*=aZ;a2*=a1;aS*=aZ;a6-=a8;aW-=aX;a4-=a8;aU-=aX;a3-=a5;aT-=aV;a2-=a5;aS-=aV;aY=a3*aS-a2*aT;ba=1/aY;be=(aS*a6-aT*a4)*ba;bd=(aS*aW-aT*aU)*ba;bc=(a3*a4-a2*a6)*ba;bb=(a3*aU-a2*aW)*ba;a9=a8-be*a5-bc*aV;a7=aX-bd*a5-bb*aV;g.save();g.transform(be,bd,bc,bb,a9,a7);g.clip();g.drawImage(a0,0,0);g.restore()}function an(aY,aV,aX){var aS=aV.x-aY.x,aW=aV.y-aY.y,aT=aS*aS+aW*aW,aU;if(aT===0){return}aU=aX/Math.sqrt(aT);aS*=aU;aW*=aU;aV.x+=aS;aV.y+=aW;aY.x-=aS;aY.y-=aW}function F(aS){if(aF!==aS){g.globalAlpha=aS;aF=aS}}function ao(aS){if(aB!==aS){if(aS===THREE.NormalBlending){g.globalCompositeOperation="source-over"}else{if(aS===THREE.AdditiveBlending){g.globalCompositeOperation="lighter"}else{if(aS===THREE.SubtractiveBlending){g.globalCompositeOperation="darker"}}}aB=aS}}function N(aS){if(O!==aS){g.lineWidth=aS;O=aS}}function ae(aS){if(l!==aS){g.lineCap=aS;l=aS}}function aJ(aS){if(aw!==aS){g.lineJoin=aS;aw=aS}}function aC(aS){if(z!==aS){g.strokeStyle=aS;z=aS}}function am(aS){if(aA!==aS){g.fillStyle=aS;aA=aS}}function Z(aS){if(T.length!==aS.length){g.setLineDash(aS);T=aS}}};